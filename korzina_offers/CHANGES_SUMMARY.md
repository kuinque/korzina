# –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π - –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ö–µ–º—É –ë–î

**–î–∞—Ç–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ä–∞—è —Å—Ö–µ–º–∞:** –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `products`, `shops`, `prices`

**–ù–æ–≤–∞—è —Å—Ö–µ–º–∞:** –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `offers`

```sql
CREATE TABLE offers (
    offer_id      SERIAL PRIMARY KEY,
    title         VARCHAR(255) NOT NULL,
    description   TEXT,
    price         BIGINT,
    currency      VARCHAR(10),
    images        TEXT[],
    category_id   INTEGER,
    category_name VARCHAR(255),
    tags          TEXT[],
    seller_name   VARCHAR(255)
);
```

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `app/models/__init__.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Offer`
- ‚úÖ `app/database/client.py` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `offers`
- ‚úÖ `app/services/shop_search_service.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ `seller_name`
- ‚úÖ `app/api/routes.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ endpoints
- ‚úÖ `tests/test_api.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –º–æ–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã
- ‚úÖ `tests/test_services.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

---

### ‚úÖ 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ endpoint `/api/health`

**–ü—Ä–æ–±–ª–µ–º–∞:** Endpoint –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª —Ç–æ–ª—å–∫–æ GET, –Ω–æ –ø–æ–ª—É—á–∞–ª POST –∑–∞–ø—Ä–æ—Å—ã (405 Method Not Allowed)

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–æ–≤ —á–µ—Ä–µ–∑ `@router.api_route(methods=["GET", "POST"])`

**–§–∞–π–ª—ã:**
- ‚úÖ `app/api/routes.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ POST
- ‚úÖ `tests/test_api.py` - –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_health_check_success_post`

---

### ‚úÖ 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –∏–∑-–∑–∞:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `elif` –≤–º–µ—Å—Ç–æ `if` –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
2. –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ similarity (0.6-0.7) –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–µ–π—Å—ã:**
- "—è–±–ª–æ–∫–∏" vs "–Ø–±–ª–æ–∫–∏ –ì–æ–ª–¥–µ–Ω" ‚Üí similarity=0.63 < 0.7 ‚ùå
- "–º–æ–ª–æ–∫–æ" vs "–ú–æ–ª–æ–∫–æ –î–æ–º–∏–∫ –≤ –¥–µ—Ä–µ–≤–Ω–µ" ‚Üí similarity=0.43 < 0.6 ‚ùå
- "—Ö–ª–µ–±" vs "–•–ª–µ–± –±–µ–ª—ã–π" ‚Üí similarity=0.57 < 0.6 ‚ùå

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–º–µ–Ω–µ–Ω—ã `elif` –Ω–∞ `if` - —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ—Ä–æ–≥–æ–≤:
   - –ï—Å–ª–∏ `target` —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ `product` ‚Üí –ø–æ—Ä–æ–≥ —Å–Ω–∏–∂–∞–µ—Ç—Å—è –¥–æ 0.4
   - –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ 0.6

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "status": "success",
  "best_shop": "–ü—è—Ç—ë—Ä–æ—á–∫–∞",
  "total_price": 23390.0,
  "products_found": 3,
  "products_total": 3,
  "match_percentage": 1.0,
  "products": [
    {"target": "—è–±–ª–æ–∫–∏", "found": "–Ø–±–ª–æ–∫–∏ –∫—Ä–∞—Å–Ω—ã–µ", "similarity": 0.6},
    {"target": "–º–æ–ª–æ–∫–æ", "found": "–ú–æ–ª–æ–∫–æ –î–æ–º–∏–∫ –≤ –¥–µ—Ä–µ–≤–Ω–µ", "similarity": 0.43},
    {"target": "—Ö–ª–µ–±", "found": "–•–ª–µ–± –±–µ–ª—ã–π", "similarity": 0.57}
  ]
}
```

**–§–∞–π–ª—ã:**
- ‚úÖ `app/services/product_service.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
16 passed, 1 warning in 0.59s ‚úÖ
```

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ!

---

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API

### –¢–µ—Å—Ç 1: Health Check
```bash
curl http://localhost:5000/api/health
# ‚úÖ 200 OK (GET –∏ POST)
```

### –¢–µ—Å—Ç 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```bash
curl http://localhost:5000/api/stats
# ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
```

### –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
```bash
curl -X POST http://localhost:5000/api/search \
  -H "Content-Type: application/json" \
  -d '{"products": ["—è–±–ª–æ–∫–∏", "–º–æ–ª–æ–∫–æ", "—Ö–ª–µ–±"]}'
# ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ 3 —Ç–æ–≤–∞—Ä–∞ —É –ø—Ä–æ–¥–∞–≤—Ü–∞ "–ü—è—Ç—ë—Ä–æ—á–∫–∞"
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (4 —É—Ä–æ–≤–Ω—è):

1. **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)
   - "—è–±–ª–æ–∫–∏" == "—è–±–ª–æ–∫–∏" ‚Üí match ‚úÖ

2. **–ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞–º–∏** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
   - "—è–±–ª–æ–∫–∏" in "—Å–≤–µ–∂–∏–µ —è–±–ª–æ–∫–∏" ‚Üí similarity ‚â• 0.7 ‚úÖ

3. **–¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –±–µ–∑ —Å—Ç–æ–ø-—Å–ª–æ–≤** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
   - "—è–±–ª–æ–∫–∏" == "—è–±–ª–æ–∫–∏" (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è "—Å–≤–µ–∂–∏–µ", "–±–æ–ª—å—à–∏–µ" –∏ —Ç.–¥.) ‚úÖ

4. **–ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –±–µ–∑ —Å—Ç–æ–ø-—Å–ª–æ–≤** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
   - "—è–±–ª–æ–∫–∏" in "—è–±–ª–æ–∫–∏ –≥–æ–ª–¥–µ–Ω" ‚Üí similarity ‚â• 0.4-0.6 ‚úÖ
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥: 0.4 –µ—Å–ª–∏ target —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ product, –∏–Ω–∞—á–µ 0.6

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã DatabaseClient:

| –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ | –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ |
|--------------|-------------|
| `get_all_products()` | `get_all_offers()` |
| `get_shops()` | `get_unique_sellers()` |
| `get_shop_by_name()` | `get_seller_info()` |
| `get_prices_for_shop_with_details()` | `get_offers_by_seller()` |

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API (—Ç–µ –∂–µ endpoints –∏ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤)
- –ü–∞—Ä–∞–º–µ—Ç—Ä `shop` —Ç–µ–ø–µ—Ä—å –æ–∑–Ω–∞—á–∞–µ—Ç `seller_name`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π: `description`, `images`, `category`, `tags`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG –¥–ª—è –¥–µ—Ç–∞–ª–µ–π, INFO –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## ‚ú® –ò—Ç–æ–≥–æ

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ö–µ–º—É –ë–î –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

